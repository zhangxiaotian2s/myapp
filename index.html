<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="css/mui.min.css">
		<style>
			.my-mui-bar-tab {
				background: #FFFFFF;
				border-top: #e1e1e1 solid 1px!important;
				bottom: -1px;
			}
			
			.my-mui-bar-tab span {
				display: block;
				font-size: 26px;
				color: #999999;
			}
			
			.my-mui-bar-tab p {
				font-size: 12px;
				margin: 0px auto;
			}
			
			.my-mui-bar-tab .mui-active p,
			.my-mui-bar-tab .mui-active span {
				color: #ff6668;
			}
			
			.mui-bar-nav {
				background: #FFFFFF;
				border-bottom: #fe6f5f solid 1px;
			}
			
			.mui-bar-nav h1 {
				font-size: 18px;
				color: #000000;
			}
			
			.mui-bar-nav a {
				color: #fe6f5f;
				;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<h1 class="mui-title" id="mui-title">摄影圈</h1>
			<a id="info" class="iconfont   icon-sousuo mui-icon  mui-pull-right"></a>
			<!--<a id="info" class="mui-icon-close mui-icon  mui-pull-right" ></a>-->
		</header>

		<nav class="mui-bar mui-bar-tab my-mui-bar-tab">
			<a class="mui-tab-item  mui-active" href="page-photollist.html" data-title="影展" data-index='0'>
				<span class="iconfont icon-tupian5" style="font-size: 25px;"></span>
				<p>影展</p>
			</a>
			<a class="mui-tab-item" href="page-newslist.html" data-title="资讯" data-index='1'>
				<span class="iconfont  icon-xinwendongtai" style="font-size: 28px;"></span>
				<p>资讯</p>
			</a>
			<a class="mui-tab-item" href="page_PersonalCenter.html" data-title="个人中心" data-index='2'>
				<span class="iconfont icon-gerenzhongxin" style="font-size: 25px;"></span>
				<p>我</p>
			</a>
		</nav>
		<script src="js/mui.min.js"></script>
		<script src="js/update.js" type="text/javascript" charset="utf-8"></script>

		<script>
			var menu = null,
				main = null;
			var showMenu = false;
			mui.init({
				swipeBack: false,
				statusBarBackground: '#FFFFFF',
				gestureConfig: {
					doubletap: true
				}
			});
			//敲击顶部导航，内容区回到顶部
			document.querySelector('header').addEventListener('doubletap', function() {
				//				main.children()[0].styles.scrollsToTop=true;
				main.children()[0].evalJS('mui.scrollTo(0, 100)');
			});
			//首页返回键处理
			//处理逻辑：1秒内，连续两次按返回键，则退出应用；
			var first = null;
			mui.back = function() {
				if (showMenu) {
					//					closeMenu();
				} else {
					//首次按键，提示‘再按一次退出应用’
					if (!first) {
						first = new Date().getTime();
						mui.toast('再按一次退出应用');
						setTimeout(function() {
							first = null;
						}, 1000);
					} else {
						if (new Date().getTime() - first < 1000) {
							plus.runtime.quit();
						}
					}
				}
			};
			var subpages = ['page-photollist.html', 'page-newslist.html', 'page_PersonalCenter.html'];
			var subpage_style = {
				top: '45px',
				bottom: '50px',
				bounce: 'vertical',
				scrollsToTop: true,
				hardwareAccelerated: true
			};
			//创建子页面，首个选项卡页面显示，其它均隐藏；
			mui.plusReady(function() {
			    plus.navigator.setFullscreen(false);
				plus.navigator.setStatusBarBackground("#ffffff");
				main = plus.webview.currentWebview();
				for (i = 0; i < 3; i++) {
					var sub = mui.preload({
						url: subpages[i],
						id: subpages[i],
						styles: subpage_style,
					})
					if (i > 0) {
						sub.hide()
					}
					main.append(sub);
				}
				plus.storage.setItem('tab_index', '0')
			
			});
			//创建一个指定openWindow的方法
			var activeTab = subpages[0];
			var lastActiveTabs = new Array();
			var mui_title = document.getElementById('mui-title');
			//选项卡点击事件
			mui('.mui-bar-tab').on('tap', 'a', function(e) {
				var	islogin = plus.storage.getItem('islogin')
				alert(islogin)
				var _this=this
				var _index = this.getAttribute('data-index')
				var tab_index = plus.storage.getItem('tab_index');
				var targetTab = this.getAttribute('href');
				var title = this.getAttribute('data-title');
				//打开页面
				if (targetTab == activeTab) {
					return;
				}
				//个人中心判断是是否登陆状态 未登录则跳转到登陆据界面
				if (islogin == 'islogin' && targetTab == 'page_PersonalCenter.html') {
					
					mui.openWindow({
						url: 'mypages/login.html',
						id: 'mypages/login',
						styles: {
							top: '0px', //新页面顶部位置
							bottom: '0px', //新页面底部位置
						},
						show: {
							autoShow: true,
							aniShow: 'slide-in-right',
							duration: '300'
						},
						waiting: {
						autoShow: false
					}
					})
				//登陆状态返回时 清除activa 样式 必须这样写才生效
				setTimeout(function(){
			      _this.classList.remove('mui-active')
			      document.querySelectorAll('.mui-tab-item')[tab_index].setAttribute('class','mui-tab-item mui-active')
				},0)
				
					
				}else{
				
				//先隐藏当前的
				if (tab_index <= _index) {
					plus.webview.hide(activeTab, 'slide-out-left', 400, function() {});
					//再显示目标
					plus.webview.show(targetTab, 'slide-in-right', 400, function() {
						mui_title.innerText = title
					});
				} else {
					plus.webview.hide(activeTab, 'slide-out-right', 400, function() {});
					//再显示目标
					plus.webview.show(targetTab, 'slide-in-left', 400, function() {
						mui_title.innerText = title
					});
				}
				plus.storage.setItem('tab_index', _index)
				activeTab = targetTab;
				}
			
				
			});
		</script>
	</body>

</html>