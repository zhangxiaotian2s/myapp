<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<!--标准mui.css-->
		<link rel="stylesheet" href="../css/mui.min.css">
		<!--App自定义的css-->
		<!--<link rel="stylesheet" type="text/css" href="../css/app.css"/>-->
		<style>
			.mui-bar-nav {
				background: #FFFFFF;
				border-bottom: #fe6f5f solid 1px;
			}
			
			h5 {
				margin: 5px 7px;
			}
			
			.mui-bar-nav h1 {
				font-size: 18px;
				color: #000000;
			}
			
			.mui-search input {}
			
			#submit_btn {
				padding-top: 10px;
				color: #ed6b5d;
			}
			
			.news_list {
				padding: 0px;
			}
			
			.news_list li {
				padding: 5px 7px 0px;
				border-bottom: #f1f1f1 solid 1px;
				border-top: #f1f1f1 solid 1px;
				overflow: hidden;
			}
			
			.news_list li h2 {
				font-size: 18px;
				font-weight: normal;
				line-height: 20px;
				padding-bottom: 5px;
				padding-left: 3px;
			}
			
			.news_list li .list-img-box {
				height: 68px;
				background: url(../images/zwf16_9.jpg) no-repeat center;
				background-size: 96% 96%;
				overflow: hidden;
			}
			
			.news_list li .list-img-box img {
				width: 96%;
				margin: auto;
			}
			
			.news_list p {
				line-height: 30px;
				float: left;
				margin-top: 7px;
				padding-left: 3px;
			}
			
			.news-shoucang {
				padding: 3px 15px;
				border: #b9b9b9 solid 1px;
				margin: 10px 10px 5px 0px;
				float: right;
				font-size: 14px;
				border-radius: 15px;
				color: #b9b9b9;
				line-height: 22px;
			}
			
			.news-shoucang span {
				font-size: 17px;
				display: block;
				float: left;
				margin-top: 3px;
			}
			
			.news-huifu {
				padding: 3px 15px;
				border: #b9b9b9 solid 1px;
				margin: 10px 10px 5px 0px;
				float: right;
				font-size: 14px;
				border-radius: 15px;
				color: #b9b9b9;
				line-height: 22px;
			}
			
			.news-huifu span {
				font-size: 17px;
				display: block;
				float: left;
				margin-top: 3px;
			}
			
			.mui-slider .mui-slider-item img {
				width: 100%!important;
			}
		</style>
	</head>

	<body style="background: #FFFFFF;">
		<header class="mui-bar mui-bar-nav">
			<h1 class="mui-title" id="mui-title">资讯搜索</h1>
			<a id="info" class="mui-action-back   mui-icon-close mui-icon  mui-pull-left" style="color: #ed6b5d;"></a>
			<a id="submit_btn" class="mui-pull-right">搜索</a>
		</header>
		<div class="mui-content">
			<div class="mui-blank-10"></div>
			<div class="mui-row" style="padding: 0px 10px;">

				<div class="mui-input-row mui-search ">
					<input id="search" type="search" class="mui-input-speech mui-input-clear" placeholder="输入关键字">
				</div>
				<ul id="news_list" class="news_list" style="background: #FFFFFF;">

				</ul>

			</div>
		</div>
		<script src="../js/mui.min.js"></script>
		<script>
			mui.init({
				swipeBack: true //启用右滑关闭功能
			});
			var news_list = document.getElementById('news_list')
			var seachinput = document.getElementById('search');
			var searchbtn = document.getElementById('submit_btn')
			mui.plusReady(function() {
				mui('#news_list').on('tap', 'li', function() {
					var news_uuid = this.getAttribute('id');
					var user_uuid = plus.storage.getItem('uuid')
					setNewsListTap(news_uuid, user_uuid)
				})
			})
			//语音识别完成事件
			seachinput.addEventListener('recognized', function(e) {
				news_list.innerHTML = ""
				inserPageNewsList(e.detail.value)
			});
			searchbtn.addEventListener('tap', function() {
				news_list.innerHTML = ""
				var keyword = seachinput.value
				if (keyword == '') {
					return
				}
				inserPageNewsList(keyword)
			})
			seachinput.addEventListener('keydown', function(e) {
				var key = e.which
				if (key == 13) {
					var keyword = seachinput.value
					news_list.innerHTML = ""
					inserPageNewsList(keyword)
				}
			})

			function inserPageNewsList(keyword) {
				var waiting=plus.nativeUI.showWaiting()
				mui.ajax('http://sheying.development.mastergolf.cn/api/v1/article/search.json?key_word=' + keyword, {
					data: {
						key_word: keyword
					},
					type: 'get',
					timeout: '10000',
					success: function(data) {
						waiting.close()
						var code = data.code
						insertNewsList(data)
					},
					error: function() {}
				})
			}

			function insertNewsList(data) {
				var _news = data.data.articles
				for (i = 0; i < _news.length; i++) {
					setNewsListType(_news[i].uuid, _news[i].title, _news[i].images, _news[i].author, _news[i].comments, _news[i].favorites)
				}
			}

			function setNewsListType(uuid, title, arrimg, author, comments, favorites) {
				var type = arrimg.length;
				var _html = '';
				var hiddeClass = ""
				if (comments == 0 || comments == "") {
					hiddeClass = "mui-hidden"
				}
				if (type == 0) {
					_html += '<li class="img_zero_news mui-row" id="' + uuid + '" ><div class="mui-col-xs-12"><h2>' + title + '</h2></div><p>' + author + '</p><div class="news-shoucang"><span class="mui-icon mui-icon-star"></span>' + favorites + '</div><div class="news-huifu"><span class="mui-icon mui-icon-chat ' + hiddeClass + '"></span>' + comments + '</div></li>'
				} else if (type < 3) {
					_html += '<li class="img_one_news" id="' + uuid + '"><div class="mui-row"><div class="mui-col-xs-8"><h2>' + title + '</h2></div><div class="mui-col-xs-4 list-img-box"><img src="' + arrimg[0] + '" class="img-responsive"></div></div><p>' + author + '</p><div class="news-shoucang"><span class="mui-icon mui-icon-star"></span>' + favorites + '</div><div class="news-huifu"><span class="mui-icon mui-icon-chat ' + hiddeClass + ' "></span>' + comments + '</div></li>'
				} else if (type >= 3) {
					_html += '<li class="img_three_news" id="' + uuid + '"><h2>' + title + '</h2><div class="img_list mui-row"><div class="mui-col-xs-4 list-img-box"><img src="' + arrimg[0] + '" class="img-responsive"></div><div class="mui-col-xs-4 list-img-box"><img src="' + arrimg[1] + '" class="img-responsive"></div><div class="mui-col-xs-4 list-img-box"><img src="' + arrimg[2] + '" class="img-responsive"></div></div><p>' + author + '</p><div class="news-shoucang"><span class="mui-icon mui-icon-star"></span>' + favorites + '</div><div class="news-huifu"><span class="mui-icon mui-icon-chat ' + hiddeClass + ' "></span>' + comments + '</div></li>'
				}
				news_list.innerHTML += _html
			}
			///////////点击到内容页面的处理
			function setNewsListTap(news_uuid, user_uuid) {
				mui.openWindow({
					id: 'news.html',
					url: 'news.html',
					styles: {
						top: '0px',
						bottom: '0px',
						scrollsToTop: true,
					},
					show: {
						duration: 300
					},
					extras: {
						uuid: news_uuid,
						user_uuid: user_uuid
					},
					waiting: {
						autoShow: false
					}
				});
			}
		</script>
	</body>

</html>